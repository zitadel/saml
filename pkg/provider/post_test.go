package provider

import (
	"testing"

	"github.com/zitadel/saml/pkg/provider/serviceprovider"
	"github.com/zitadel/saml/pkg/provider/xml/md"
	"github.com/zitadel/saml/pkg/provider/xml/xml_dsig"
)

func TestSSO_signaturePostVerificationNecessary(t *testing.T) {
	type args struct {
		sig         *xml_dsig.SignatureType
		binding     string
		idpMetadata *md.IDPSSODescriptorType
		spMetadata  *md.EntityDescriptorType
	}
	tests := []struct {
		name string
		args args
		res  bool
	}{
		{
			"post signature",
			args{
				sig: &xml_dsig.SignatureType{
					SignatureValue: xml_dsig.SignatureValueType{Text: "test"},
				},
				binding: PostBinding,
				spMetadata: &md.EntityDescriptorType{
					SPSSODescriptor: &md.SPSSODescriptorType{
						AuthnRequestsSigned: "false",
					},
				},
				idpMetadata: &md.IDPSSODescriptorType{
					WantAuthnRequestsSigned: "false",
				},
			},
			true,
		},
		{
			"post AuthnRequestsSigned",
			args{
				sig: &xml_dsig.SignatureType{
					SignatureValue: xml_dsig.SignatureValueType{Text: ""},
				},
				binding: PostBinding,
				spMetadata: &md.EntityDescriptorType{
					SPSSODescriptor: &md.SPSSODescriptorType{
						AuthnRequestsSigned: "true",
					},
				},
				idpMetadata: &md.IDPSSODescriptorType{
					WantAuthnRequestsSigned: "false",
				},
			},
			true,
		},
		{
			"post WantAuthnRequestsSigned",
			args{
				sig: &xml_dsig.SignatureType{
					SignatureValue: xml_dsig.SignatureValueType{Text: ""},
				},
				binding: PostBinding,
				spMetadata: &md.EntityDescriptorType{
					SPSSODescriptor: &md.SPSSODescriptorType{
						AuthnRequestsSigned: "false",
					},
				},
				idpMetadata: &md.IDPSSODescriptorType{
					WantAuthnRequestsSigned: "true",
				},
			},
			true,
		},
		{
			"post no signature",
			args{
				sig: &xml_dsig.SignatureType{
					SignatureValue: xml_dsig.SignatureValueType{Text: ""},
				},
				binding: PostBinding,
				spMetadata: &md.EntityDescriptorType{
					SPSSODescriptor: &md.SPSSODescriptorType{
						AuthnRequestsSigned: "false",
					},
				},
				idpMetadata: &md.IDPSSODescriptorType{
					WantAuthnRequestsSigned: "false",
				},
			},
			false,
		},
		{
			"redirect all required",
			args{
				sig: &xml_dsig.SignatureType{
					SignatureValue: xml_dsig.SignatureValueType{Text: "test"},
				},
				binding: RedirectBinding,
				spMetadata: &md.EntityDescriptorType{
					SPSSODescriptor: &md.SPSSODescriptorType{
						AuthnRequestsSigned: "true",
					},
				},
				idpMetadata: &md.IDPSSODescriptorType{
					WantAuthnRequestsSigned: "true",
				},
			},
			false,
		},
		{
			"redirect nothing required",
			args{
				sig: &xml_dsig.SignatureType{
					SignatureValue: xml_dsig.SignatureValueType{Text: ""},
				},
				binding: RedirectBinding,
				spMetadata: &md.EntityDescriptorType{
					SPSSODescriptor: &md.SPSSODescriptorType{
						AuthnRequestsSigned: "false",
					},
				},
				idpMetadata: &md.IDPSSODescriptorType{
					WantAuthnRequestsSigned: "false",
				},
			},
			false,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			idpMetadataF := func() *md.IDPSSODescriptorType {
				return tt.args.idpMetadata
			}
			spMetadataF := func() *md.EntityDescriptorType {
				return tt.args.spMetadata
			}
			signatureF := func() *xml_dsig.SignatureType {
				return tt.args.sig
			}
			bindingF := func() string {
				return tt.args.binding
			}

			gotF := signaturePostVerificationNecessary(idpMetadataF, spMetadataF, signatureF, bindingF)
			got := gotF()
			if got != tt.res {
				t.Errorf("signaturePostVerificationNecessary() got = %v, want %v", got, tt.res)
			}
		})
	}
}

func TestSSO_verifyPostSignature(t *testing.T) {
	type args struct {
		request    string
		spMetadata string
	}
	tests := []struct {
		name string
		args args
		err  bool
	}{
		{
			"post signed request 1",
			args{
				request:    "PHNhbWxwOkF1dGhuUmVxdWVzdCB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiB4bWxuczpzYW1scD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiBJRD0iaWQtMjA4ZmZjZDllODFiNDU4Y2RlY2RiMTNlNWVkNDdhZTg3ODRmNzU2MiIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMjMtMDQtMDZUMDg6MTI6NTkuODEyWiIgRGVzdGluYXRpb249Imh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9zYW1sL3YyL1NTTyIgQXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVVJMPSJodHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9hY3MiIFByb3RvY29sQmluZGluZz0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmJpbmRpbmdzOkhUVFAtUE9TVCI+PHNhbWw6SXNzdWVyIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5Ij5odHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9tZXRhZGF0YTwvc2FtbDpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PGRzOlNpZ25lZEluZm8+PGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+PGRzOlJlZmVyZW5jZSBVUkk9IiNpZC0yMDhmZmNkOWU4MWI0NThjZGVjZGIxM2U1ZWQ0N2FlODc4NGY3NTYyIj48ZHM6VHJhbnNmb3Jtcz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PC9kczpUcmFuc2Zvcm1zPjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPjxkczpEaWdlc3RWYWx1ZT5TY2NEc0pIaFIvTHRGM25sRmI0SnFUdHRaWHM9PC9kczpEaWdlc3RWYWx1ZT48L2RzOlJlZmVyZW5jZT48L2RzOlNpZ25lZEluZm8+PGRzOlNpZ25hdHVyZVZhbHVlPmZvemhzL1dSUEJyeUtCR21wdE5vNWc0ZVJMdUYwaXNVazUwaCtpM0hpVlRGMCtCZ0NiQUNhZWNTSnhxK2xzS2VtSUoxdWdGK0NDekE4KzZyVmdOWE5kbklIRUJleXdRb1Nhc3dJOHFURm5BcTdSMjlVMmdIcDhoQmNTNk5BVHJxNldsWnBERllwWmZrUEtpbTBEdEJaK1dHM3lNQW9pNmlJZ1dvOVRLNVp5dWl6VzFMNGtTN1BiK1F4ZktEMVFaNU1ieVZGUVE5TWRHQ2lJcGtJOXRFOVpxcU5iS25XdnBsZk9RUi9mSTRQYU5MSllaSHpnbW9kWERobGVqa1RtVGFoYXhEYVB4dHljblZxaWkvMldwVk1aaVZDUTFsWEgxc2VNS24xK0ZtNkdCUW52VDdvS01vMzZaVkF4Qk5TVFIwTmNaTVQzM1FRWXNOVTJQNjZ5akJjdz09PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlDdkRDQ0FhUUNDUUNIZUV0ZHJVSWc5REFOQmdrcWhraUc5dzBCQVFzRkFEQWdNUjR3SEFZRFZRUUREQlZ0ZVhObGNuWnBZMlV1WlhoaGJYQnNaUzVqYjIwd0hoY05Nak13TkRBMU1UVXdPVEEzV2hjTk16TXdOREF5TVRVd09UQTNXakFnTVI0d0hBWURWUVFEREJWdGVYTmxjblpwWTJVdVpYaGhiWEJzWlM1amIyMHdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDN2QxcDArV3dvUHRFb2ZnK1pXTzNtNjdyYTZEUXJBbDlJbUx2djh3WXkyQUFsc1hsdzBWaEVDV1ZvRVhmZVdCaWV1aW8wMHF0MGdDQnBiZytMMC9HazBRbFRWcWh3cGhVZDJ0OTRhcERiODZtWEVBQzE2VGlEcjFFZGZXMjZOVVd0cFFVSzdWUXU1MUVqYThMalo4ZjJqeUhPWTFBUXdxbktXc0wxQkV3YU5mTUs4TWRpeXJ0c2xOZmpLemk1eGJ2QytOQTFMNndES3pIait2Mm1HYy9wNEhLRmpoczlrZTRXdFZWajZRak1aRlNack5VcGRJWlFoNytoUG9tWlVwNS9kR2NZbHFxY2V6d0RYdWkxa0hpT1U3emJncERuZ1ZkYWFkYU5sVFNrYlRUTHA2dFJCcDVqU1V6WWRYRXdtNDBZem9zbENxZngyZ29pUUxPeHQyK0RBZ01CQUFFd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFBdDVhS2lQQVBTbmlTZzg1dDJNRitxekFETmthTC9CUWUyQlR3WDhNY0RrQTU4RFVwVERnK0phMnFYL3JYV255UXVtZmd3enJYWUhIRzhmMlJpdVRxT0RpMU9CQk1Wb1ZEejFnelhTVHZ4OVErM2VaVzUzYlhGaUF2OUNFejJLVHhHZlpzbStQUm1lOGZSRGZYc3cyUmtHTzU4WEZ2TXNnN3plVU1LTWtFZjFYU0Q4bU1EeXFITCtnQ1hBdFlJUjZBV2xKMzlSZW1hWldieHlCN1JzQU56OWl1V1ltbGpONmx6a0lwSHBmR3NVU1dNK0hxbVI2aG4vcW4ybUFxZTRLakE3NE42L2ZTUkZLOVZqTWIva0FFRllFaGhyL3kyam82Zi9md2FHYWVPb09NQUFjS1djVHVXZytDd2lIZVl4SFNIVUZ0NGpaODdIWkFjOUVPdm1LRkE9PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWxwOk5hbWVJRFBvbGljeSBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnRyYW5zaWVudCIgQWxsb3dDcmVhdGU9InRydWUiLz48L3NhbWxwOkF1dGhuUmVxdWVzdD4=",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2023-04-08T08:29:26.467Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2023-04-08T08:29:26.467195Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQCHeEtdrUIg9DANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjMwNDA1MTUwOTA3WhcNMzMwNDAyMTUwOTA3WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7d1p0+WwoPtEofg+ZWO3m67ra6DQrAl9ImLvv8wYy2AAlsXlw0VhECWVoEXfeWBieuio00qt0gCBpbg+L0/Gk0QlTVqhwphUd2t94apDb86mXEAC16TiDr1EdfW26NUWtpQUK7VQu51Eja8LjZ8f2jyHOY1AQwqnKWsL1BEwaNfMK8MdiyrtslNfjKzi5xbvC+NA1L6wDKzHj+v2mGc/p4HKFjhs9ke4WtVVj6QjMZFSZrNUpdIZQh7+hPomZUp5/dGcYlqqcezwDXui1kHiOU7zbgpDngVdaadaNlTSkbTTLp6tRBp5jSUzYdXEwm40YzoslCqfx2goiQLOxt2+DAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAAt5aKiPAPSniSg85t2MF+qzADNkaL/BQe2BTwX8McDkA58DUpTDg+Ja2qX/rXWnyQumfgwzrXYHHG8f2RiuTqODi1OBBMVoVDz1gzXSTvx9Q+3eZW53bXFiAv9CEz2KTxGfZsm+PRme8fRDfXsw2RkGO58XFvMsg7zeUMKMkEf1XSD8mMDyqHL+gCXAtYIR6AWlJ39RemaZWbxyB7RsANz9iuWYmljN6lzkIpHpfGsUSWM+HqmR6hn/qn2mAqe4KjA74N6/fSRFK9VjMb/kAEFYEhhr/y2jo6f/fwaGaeOoOMAAcKWcTuWg+CwiHeYxHSHUFt4jZ87HZAc9EOvmKFA=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQCHeEtdrUIg9DANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjMwNDA1MTUwOTA3WhcNMzMwNDAyMTUwOTA3WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7d1p0+WwoPtEofg+ZWO3m67ra6DQrAl9ImLvv8wYy2AAlsXlw0VhECWVoEXfeWBieuio00qt0gCBpbg+L0/Gk0QlTVqhwphUd2t94apDb86mXEAC16TiDr1EdfW26NUWtpQUK7VQu51Eja8LjZ8f2jyHOY1AQwqnKWsL1BEwaNfMK8MdiyrtslNfjKzi5xbvC+NA1L6wDKzHj+v2mGc/p4HKFjhs9ke4WtVVj6QjMZFSZrNUpdIZQh7+hPomZUp5/dGcYlqqcezwDXui1kHiOU7zbgpDngVdaadaNlTSkbTTLp6tRBp5jSUzYdXEwm40YzoslCqfx2goiQLOxt2+DAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAAt5aKiPAPSniSg85t2MF+qzADNkaL/BQe2BTwX8McDkA58DUpTDg+Ja2qX/rXWnyQumfgwzrXYHHG8f2RiuTqODi1OBBMVoVDz1gzXSTvx9Q+3eZW53bXFiAv9CEz2KTxGfZsm+PRme8fRDfXsw2RkGO58XFvMsg7zeUMKMkEf1XSD8mMDyqHL+gCXAtYIR6AWlJ39RemaZWbxyB7RsANz9iuWYmljN6lzkIpHpfGsUSWM+HqmR6hn/qn2mAqe4KjA74N6/fSRFK9VjMb/kAEFYEhhr/y2jo6f/fwaGaeOoOMAAcKWcTuWg+CwiHeYxHSHUFt4jZ87HZAc9EOvmKFA=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			false,
		},
		{
			"post signed request 2",
			args{
				request:    "PHNhbWxwOkF1dGhuUmVxdWVzdCB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiB4bWxuczpzYW1scD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiBJRD0iaWQtNTkzZGRlMDZjODVmM2UzNmI1YmRjNjZkZjAwNTg2NjA5OTA0ZWM1MiIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMjMtMDQtMDZUMDg6MzE6MjkuMTU2WiIgRGVzdGluYXRpb249Imh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9zYW1sL3YyL1NTTyIgQXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVVJMPSJodHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9hY3MiIFByb3RvY29sQmluZGluZz0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmJpbmRpbmdzOkhUVFAtUE9TVCI+PHNhbWw6SXNzdWVyIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5Ij5odHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9tZXRhZGF0YTwvc2FtbDpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PGRzOlNpZ25lZEluZm8+PGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+PGRzOlJlZmVyZW5jZSBVUkk9IiNpZC01OTNkZGUwNmM4NWYzZTM2YjViZGM2NmRmMDA1ODY2MDk5MDRlYzUyIj48ZHM6VHJhbnNmb3Jtcz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PC9kczpUcmFuc2Zvcm1zPjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPjxkczpEaWdlc3RWYWx1ZT5LRzQwRno1L0I5Ynhzb2JBN3BWaTdsKzlRYU09PC9kczpEaWdlc3RWYWx1ZT48L2RzOlJlZmVyZW5jZT48L2RzOlNpZ25lZEluZm8+PGRzOlNpZ25hdHVyZVZhbHVlPnJyRXppa3hZVTRVSXVJUVZuNy9RVXdXWk9yZ2NhRHJxSFNPVTRRODdZK1VFSG9wQkxIbTBqYXhDYnNqVGR4Zmc1ZTlpemdNcHFHRHhaYlZWKzNxYkkvWStPUzdYTHJXcnRWQmlhM2FVaGw4bFRjU2VrQlZUcGV1Q0hueklsWEdLRGdBSXNuOEhYSzVhbXZOaFl2Y0hSR2dROTRlSFRQNGpkU2RzclFDdU5pL1VGQ0JwUnJwdVcyZkg3NDBpZU12dmRFQzhYS01QL1UyaS9QZGZTUmU0azNpc2VIWE94RnQxZTZJSm5rakJ5Vmt1M2Y0WWt1ZGFtQUVKMGRKbDhPUjlHMnNiLzFUL0F6Y0F6c2g0eFBBWWdkaUtrZVM4dmZodnMvRllIK2dGNWlNMjRpRW1CS25kZ2RVVXJaTWVvOU9xbWJISU1UY3pUdGN0QzgzWVZ2eGtZQT09PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlDdkRDQ0FhUUNDUUNIZUV0ZHJVSWc5REFOQmdrcWhraUc5dzBCQVFzRkFEQWdNUjR3SEFZRFZRUUREQlZ0ZVhObGNuWnBZMlV1WlhoaGJYQnNaUzVqYjIwd0hoY05Nak13TkRBMU1UVXdPVEEzV2hjTk16TXdOREF5TVRVd09UQTNXakFnTVI0d0hBWURWUVFEREJWdGVYTmxjblpwWTJVdVpYaGhiWEJzWlM1amIyMHdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDN2QxcDArV3dvUHRFb2ZnK1pXTzNtNjdyYTZEUXJBbDlJbUx2djh3WXkyQUFsc1hsdzBWaEVDV1ZvRVhmZVdCaWV1aW8wMHF0MGdDQnBiZytMMC9HazBRbFRWcWh3cGhVZDJ0OTRhcERiODZtWEVBQzE2VGlEcjFFZGZXMjZOVVd0cFFVSzdWUXU1MUVqYThMalo4ZjJqeUhPWTFBUXdxbktXc0wxQkV3YU5mTUs4TWRpeXJ0c2xOZmpLemk1eGJ2QytOQTFMNndES3pIait2Mm1HYy9wNEhLRmpoczlrZTRXdFZWajZRak1aRlNack5VcGRJWlFoNytoUG9tWlVwNS9kR2NZbHFxY2V6d0RYdWkxa0hpT1U3emJncERuZ1ZkYWFkYU5sVFNrYlRUTHA2dFJCcDVqU1V6WWRYRXdtNDBZem9zbENxZngyZ29pUUxPeHQyK0RBZ01CQUFFd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFBdDVhS2lQQVBTbmlTZzg1dDJNRitxekFETmthTC9CUWUyQlR3WDhNY0RrQTU4RFVwVERnK0phMnFYL3JYV255UXVtZmd3enJYWUhIRzhmMlJpdVRxT0RpMU9CQk1Wb1ZEejFnelhTVHZ4OVErM2VaVzUzYlhGaUF2OUNFejJLVHhHZlpzbStQUm1lOGZSRGZYc3cyUmtHTzU4WEZ2TXNnN3plVU1LTWtFZjFYU0Q4bU1EeXFITCtnQ1hBdFlJUjZBV2xKMzlSZW1hWldieHlCN1JzQU56OWl1V1ltbGpONmx6a0lwSHBmR3NVU1dNK0hxbVI2aG4vcW4ybUFxZTRLakE3NE42L2ZTUkZLOVZqTWIva0FFRllFaGhyL3kyam82Zi9md2FHYWVPb09NQUFjS1djVHVXZytDd2lIZVl4SFNIVUZ0NGpaODdIWkFjOUVPdm1LRkE9PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWxwOk5hbWVJRFBvbGljeSBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnRyYW5zaWVudCIgQWxsb3dDcmVhdGU9InRydWUiLz48L3NhbWxwOkF1dGhuUmVxdWVzdD4=",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2023-04-08T08:29:26.467Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2023-04-08T08:29:26.467195Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQCHeEtdrUIg9DANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjMwNDA1MTUwOTA3WhcNMzMwNDAyMTUwOTA3WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7d1p0+WwoPtEofg+ZWO3m67ra6DQrAl9ImLvv8wYy2AAlsXlw0VhECWVoEXfeWBieuio00qt0gCBpbg+L0/Gk0QlTVqhwphUd2t94apDb86mXEAC16TiDr1EdfW26NUWtpQUK7VQu51Eja8LjZ8f2jyHOY1AQwqnKWsL1BEwaNfMK8MdiyrtslNfjKzi5xbvC+NA1L6wDKzHj+v2mGc/p4HKFjhs9ke4WtVVj6QjMZFSZrNUpdIZQh7+hPomZUp5/dGcYlqqcezwDXui1kHiOU7zbgpDngVdaadaNlTSkbTTLp6tRBp5jSUzYdXEwm40YzoslCqfx2goiQLOxt2+DAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAAt5aKiPAPSniSg85t2MF+qzADNkaL/BQe2BTwX8McDkA58DUpTDg+Ja2qX/rXWnyQumfgwzrXYHHG8f2RiuTqODi1OBBMVoVDz1gzXSTvx9Q+3eZW53bXFiAv9CEz2KTxGfZsm+PRme8fRDfXsw2RkGO58XFvMsg7zeUMKMkEf1XSD8mMDyqHL+gCXAtYIR6AWlJ39RemaZWbxyB7RsANz9iuWYmljN6lzkIpHpfGsUSWM+HqmR6hn/qn2mAqe4KjA74N6/fSRFK9VjMb/kAEFYEhhr/y2jo6f/fwaGaeOoOMAAcKWcTuWg+CwiHeYxHSHUFt4jZ87HZAc9EOvmKFA=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQCHeEtdrUIg9DANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjMwNDA1MTUwOTA3WhcNMzMwNDAyMTUwOTA3WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7d1p0+WwoPtEofg+ZWO3m67ra6DQrAl9ImLvv8wYy2AAlsXlw0VhECWVoEXfeWBieuio00qt0gCBpbg+L0/Gk0QlTVqhwphUd2t94apDb86mXEAC16TiDr1EdfW26NUWtpQUK7VQu51Eja8LjZ8f2jyHOY1AQwqnKWsL1BEwaNfMK8MdiyrtslNfjKzi5xbvC+NA1L6wDKzHj+v2mGc/p4HKFjhs9ke4WtVVj6QjMZFSZrNUpdIZQh7+hPomZUp5/dGcYlqqcezwDXui1kHiOU7zbgpDngVdaadaNlTSkbTTLp6tRBp5jSUzYdXEwm40YzoslCqfx2goiQLOxt2+DAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAAt5aKiPAPSniSg85t2MF+qzADNkaL/BQe2BTwX8McDkA58DUpTDg+Ja2qX/rXWnyQumfgwzrXYHHG8f2RiuTqODi1OBBMVoVDz1gzXSTvx9Q+3eZW53bXFiAv9CEz2KTxGfZsm+PRme8fRDfXsw2RkGO58XFvMsg7zeUMKMkEf1XSD8mMDyqHL+gCXAtYIR6AWlJ39RemaZWbxyB7RsANz9iuWYmljN6lzkIpHpfGsUSWM+HqmR6hn/qn2mAqe4KjA74N6/fSRFK9VjMb/kAEFYEhhr/y2jo6f/fwaGaeOoOMAAcKWcTuWg+CwiHeYxHSHUFt4jZ87HZAc9EOvmKFA=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			false,
		},
		{
			"post signed request 3",
			args{
				request:    "PHNhbWxwOkF1dGhuUmVxdWVzdCB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiB4bWxuczpzYW1scD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiBJRD0iaWQtMzI3NzBiMWZjZDQwYmU4ZGQ3MjM0YTE3ZDM0M2YzOGRlY2NhZWM0MyIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMjMtMDQtMDZUMDg6MzQ6MzcuMTA1WiIgRGVzdGluYXRpb249Imh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9zYW1sL3YyL1NTTyIgQXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVVJMPSJodHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9hY3MiIFByb3RvY29sQmluZGluZz0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmJpbmRpbmdzOkhUVFAtUE9TVCI+PHNhbWw6SXNzdWVyIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5Ij5odHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9tZXRhZGF0YTwvc2FtbDpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PGRzOlNpZ25lZEluZm8+PGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+PGRzOlJlZmVyZW5jZSBVUkk9IiNpZC0zMjc3MGIxZmNkNDBiZThkZDcyMzRhMTdkMzQzZjM4ZGVjY2FlYzQzIj48ZHM6VHJhbnNmb3Jtcz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PC9kczpUcmFuc2Zvcm1zPjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPjxkczpEaWdlc3RWYWx1ZT5zc0NpTzk0d1ZpV2tvVUhoYkVlOUlMcTJSTDQ9PC9kczpEaWdlc3RWYWx1ZT48L2RzOlJlZmVyZW5jZT48L2RzOlNpZ25lZEluZm8+PGRzOlNpZ25hdHVyZVZhbHVlPkU3OGhieDZaeWlqdHU0a2t4YUJsNVNqZVhheW1nWGVUYkJWOUpGOGZrKzZ5QlcwSStwNlZRV0l2cC9ENlN0SFZGRHVMc1ZIMFBYS3ZtUHE4bDBEd24zb21peHpHMHJCZS85Z1VGeEtOUTJtME16OXV2Y0kvVU8yQkswZXhGSUxXMXhWTjduL241YzZCWlNDYzJuTWNxVCtTVFoyOG9OZDBLNGdET3Q5clpwbS9IRnNiaW1tbmI5dnE2MUJzYnUxRTNleHZXRHlBbG9FbW13TUtPcDVKV0swcHZZc2V4cmxOYk5xZFcrd1Q2clRTamJ2Q3RJMDR6d0MwdG9kT2FuaHcyOCtsUER2STJIaVhtY05qRW1RZUNzT1RCdDgrWGFBbGwzYUFrUUw2WnZTWEJrVmJhQ2xQbHlxNGdmMHB1ejJ4bVFkcjBrWlhBZjR2ZDUzTVBVVDRiUT09PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlDdkRDQ0FhUUNDUUNIZUV0ZHJVSWc5REFOQmdrcWhraUc5dzBCQVFzRkFEQWdNUjR3SEFZRFZRUUREQlZ0ZVhObGNuWnBZMlV1WlhoaGJYQnNaUzVqYjIwd0hoY05Nak13TkRBMU1UVXdPVEEzV2hjTk16TXdOREF5TVRVd09UQTNXakFnTVI0d0hBWURWUVFEREJWdGVYTmxjblpwWTJVdVpYaGhiWEJzWlM1amIyMHdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDN2QxcDArV3dvUHRFb2ZnK1pXTzNtNjdyYTZEUXJBbDlJbUx2djh3WXkyQUFsc1hsdzBWaEVDV1ZvRVhmZVdCaWV1aW8wMHF0MGdDQnBiZytMMC9HazBRbFRWcWh3cGhVZDJ0OTRhcERiODZtWEVBQzE2VGlEcjFFZGZXMjZOVVd0cFFVSzdWUXU1MUVqYThMalo4ZjJqeUhPWTFBUXdxbktXc0wxQkV3YU5mTUs4TWRpeXJ0c2xOZmpLemk1eGJ2QytOQTFMNndES3pIait2Mm1HYy9wNEhLRmpoczlrZTRXdFZWajZRak1aRlNack5VcGRJWlFoNytoUG9tWlVwNS9kR2NZbHFxY2V6d0RYdWkxa0hpT1U3emJncERuZ1ZkYWFkYU5sVFNrYlRUTHA2dFJCcDVqU1V6WWRYRXdtNDBZem9zbENxZngyZ29pUUxPeHQyK0RBZ01CQUFFd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFBdDVhS2lQQVBTbmlTZzg1dDJNRitxekFETmthTC9CUWUyQlR3WDhNY0RrQTU4RFVwVERnK0phMnFYL3JYV255UXVtZmd3enJYWUhIRzhmMlJpdVRxT0RpMU9CQk1Wb1ZEejFnelhTVHZ4OVErM2VaVzUzYlhGaUF2OUNFejJLVHhHZlpzbStQUm1lOGZSRGZYc3cyUmtHTzU4WEZ2TXNnN3plVU1LTWtFZjFYU0Q4bU1EeXFITCtnQ1hBdFlJUjZBV2xKMzlSZW1hWldieHlCN1JzQU56OWl1V1ltbGpONmx6a0lwSHBmR3NVU1dNK0hxbVI2aG4vcW4ybUFxZTRLakE3NE42L2ZTUkZLOVZqTWIva0FFRllFaGhyL3kyam82Zi9md2FHYWVPb09NQUFjS1djVHVXZytDd2lIZVl4SFNIVUZ0NGpaODdIWkFjOUVPdm1LRkE9PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWxwOk5hbWVJRFBvbGljeSBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnRyYW5zaWVudCIgQWxsb3dDcmVhdGU9InRydWUiLz48L3NhbWxwOkF1dGhuUmVxdWVzdD4=",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2023-04-08T08:29:26.467Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2023-04-08T08:29:26.467195Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQCHeEtdrUIg9DANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjMwNDA1MTUwOTA3WhcNMzMwNDAyMTUwOTA3WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7d1p0+WwoPtEofg+ZWO3m67ra6DQrAl9ImLvv8wYy2AAlsXlw0VhECWVoEXfeWBieuio00qt0gCBpbg+L0/Gk0QlTVqhwphUd2t94apDb86mXEAC16TiDr1EdfW26NUWtpQUK7VQu51Eja8LjZ8f2jyHOY1AQwqnKWsL1BEwaNfMK8MdiyrtslNfjKzi5xbvC+NA1L6wDKzHj+v2mGc/p4HKFjhs9ke4WtVVj6QjMZFSZrNUpdIZQh7+hPomZUp5/dGcYlqqcezwDXui1kHiOU7zbgpDngVdaadaNlTSkbTTLp6tRBp5jSUzYdXEwm40YzoslCqfx2goiQLOxt2+DAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAAt5aKiPAPSniSg85t2MF+qzADNkaL/BQe2BTwX8McDkA58DUpTDg+Ja2qX/rXWnyQumfgwzrXYHHG8f2RiuTqODi1OBBMVoVDz1gzXSTvx9Q+3eZW53bXFiAv9CEz2KTxGfZsm+PRme8fRDfXsw2RkGO58XFvMsg7zeUMKMkEf1XSD8mMDyqHL+gCXAtYIR6AWlJ39RemaZWbxyB7RsANz9iuWYmljN6lzkIpHpfGsUSWM+HqmR6hn/qn2mAqe4KjA74N6/fSRFK9VjMb/kAEFYEhhr/y2jo6f/fwaGaeOoOMAAcKWcTuWg+CwiHeYxHSHUFt4jZ87HZAc9EOvmKFA=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQCHeEtdrUIg9DANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjMwNDA1MTUwOTA3WhcNMzMwNDAyMTUwOTA3WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7d1p0+WwoPtEofg+ZWO3m67ra6DQrAl9ImLvv8wYy2AAlsXlw0VhECWVoEXfeWBieuio00qt0gCBpbg+L0/Gk0QlTVqhwphUd2t94apDb86mXEAC16TiDr1EdfW26NUWtpQUK7VQu51Eja8LjZ8f2jyHOY1AQwqnKWsL1BEwaNfMK8MdiyrtslNfjKzi5xbvC+NA1L6wDKzHj+v2mGc/p4HKFjhs9ke4WtVVj6QjMZFSZrNUpdIZQh7+hPomZUp5/dGcYlqqcezwDXui1kHiOU7zbgpDngVdaadaNlTSkbTTLp6tRBp5jSUzYdXEwm40YzoslCqfx2goiQLOxt2+DAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAAt5aKiPAPSniSg85t2MF+qzADNkaL/BQe2BTwX8McDkA58DUpTDg+Ja2qX/rXWnyQumfgwzrXYHHG8f2RiuTqODi1OBBMVoVDz1gzXSTvx9Q+3eZW53bXFiAv9CEz2KTxGfZsm+PRme8fRDfXsw2RkGO58XFvMsg7zeUMKMkEf1XSD8mMDyqHL+gCXAtYIR6AWlJ39RemaZWbxyB7RsANz9iuWYmljN6lzkIpHpfGsUSWM+HqmR6hn/qn2mAqe4KjA74N6/fSRFK9VjMb/kAEFYEhhr/y2jo6f/fwaGaeOoOMAAcKWcTuWg+CwiHeYxHSHUFt4jZ87HZAc9EOvmKFA=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			false,
		},
		{
			"not base64 encoded",
			args{
				request:    "test not base64",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967238Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			true,
		},
		{
			"not xml but base64 encoded",
			args{
				request:    "dGVzdA==",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967238Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			true,
		},
		{
			"post not signed request",
			args{
				request:    "PHNhbWxwOkF1dGhuUmVxdWVzdCB4bWxuczpzYW1sPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24geG1sbnM6c2FtbHA9dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIElEPWlkLWI4MTMxNDdlMjIzNjI1NzVkOGE2YWY4NzU2ZTNkZjVjMTM0MWVhMDAgVmVyc2lvbj0yLjAgSXNzdWVJbnN0YW50PTIwMjItMDQtMjBUMDk6MDM6NTcuNDk1WiBEZXN0aW5hdGlvbj1odHRwOi8vbG9jYWxob3N0OjUwMDAyL3NhbWwvU1NPIEFzc2VydGlvbkNvbnN1bWVyU2VydmljZVVSTD1odHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9hY3MgUHJvdG9jb2xCaW5kaW5nPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpiaW5kaW5nczpIVFRQLVBPU1Q+PHNhbWw6SXNzdWVyIEZvcm1hdD11cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHk+aHR0cDovL2xvY2FsaG9zdDo4MDAwL3NhbWwvbWV0YWRhdGFcPC9zYW1sOklzc3Vlclw+XDxzYW1scDpOYW1lSURQb2xpY3kgRm9ybWF0PXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnRyYW5zaWVudCBBbGxvd0NyZWF0ZT10cnVlLz48L3NhbWxwOkF1dGhuUmVxdWVzdD4K",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967238Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			true,
		},
		{
			"post signed request wrong certificate",
			args{
				request:    "PHNhbWxwOkF1dGhuUmVxdWVzdCB4bWxuczpzYW1sPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24geG1sbnM6c2FtbHA9dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIElEPWlkLWI4MTMxNDdlMjIzNjI1NzVkOGE2YWY4NzU2ZTNkZjVjMTM0MWVhMDAgVmVyc2lvbj0yLjAgSXNzdWVJbnN0YW50PTIwMjItMDQtMjBUMDk6MDM6NTcuNDk1WiBEZXN0aW5hdGlvbj1odHRwOi8vbG9jYWxob3N0OjUwMDAyL3NhbWwvU1NPIEFzc2VydGlvbkNvbnN1bWVyU2VydmljZVVSTD1odHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9hY3MgUHJvdG9jb2xCaW5kaW5nPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpiaW5kaW5nczpIVFRQLVBPU1Q+PHNhbWw6SXNzdWVyIEZvcm1hdD11cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHk+aHR0cDovL2xvY2FsaG9zdDo4MDAwL3NhbWwvbWV0YWRhdGFcPC9zYW1sOklzc3Vlclw+XDxkczpTaWduYXR1cmUgeG1sbnM6ZHM9aHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIz48ZHM6U2lnbmVkSW5mbz48ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09aHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEvPjxkczpSZWZlcmVuY2UgVVJJPSNpZC1iODEzMTQ3ZTIyMzYyNTc1ZDhhNmFmODc1NmUzZGY1YzEzNDFlYTAwPjxkczpUcmFuc2Zvcm1zPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPWh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMS8+PGRzOkRpZ2VzdFZhbHVlPnY4anF2OWdSekF3cmFjazNQSEhpeGRIT0s1az08L2RzOkRpZ2VzdFZhbHVlPjwvZHM6UmVmZXJlbmNlPjwvZHM6U2lnbmVkSW5mbz48ZHM6U2lnbmF0dXJlVmFsdWU+Y0h6VnpjR1MvOEhFSXZValJSRm9jNXp4eVVQMHlXMXN6RC82ekdZZGJtTTJodnAxN0Y2dlhOOUZqdDBKbnFOZnpBVEUwRmNybCtMWG9EZjU5ZUhxQnVLN200RWlnMTBCSFdmV2tQUyt3aXM1bHg2cXNnWHBYaGNtVUlJcHdoTW5Gb3hQSFkrNmdlQ2xpcnBNNklJbjlXejNWRkNBNG8vbEUzakRtTVdXR2F3U2N4MlhwV2hFRWZlb1p2R1oyeFNSby9uczNzU0JGLzF2R0NPSjM2SWM3TW1ycnM2SzhWSENBL0VHTnNMcjg1ajJsUHpRakM2MDkydU1vamlRKzAxUFBYanlCVDJDZGVhbzF4WEVNWElob3FRTXZkc2RMbXErNmRlOHNpNGtGT1Z6YktWOEE0NFpXUkhIeHkwNU9sVmNRV1pxaFRGTjFLOHk3bkVmMWJ6eEJRPT08L2RzOlNpZ25hdHVyZVZhbHVlPjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSUN2RENDQWFRQ0NRRDZFOFpHc1EydXNqQU5CZ2txaGtpRzl3MEJBUXNGQURBZ01SNHdIQVlEVlFRRERCVnRlWE5sY25acFkyVXVaWGhoYlhCc1pTNWpiMjB3SGhjTk1qSXdNakUzTVRRd05qTTVXaGNOTWpNd01qRTNNVFF3TmpNNVdqQWdNUjR3SEFZRFZRUUREQlZ0ZVhObGNuWnBZMlV1WlhoaGJYQnNaUzVqYjIwd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUM3WEtkQ1J4VVpYamRxVnF3d3dPSnFjMUNoMG5PU21rK1VlcmtVcWx2aVdIZGVMUitGb2xIS2pxTHpDQmxvQXo0eFZjMERGZlI3NmdXY1dBSEpsb3FaN0dCUzdOcERoelY4RytjWFErYlRVMEx1MmU3M3pDUWIzMFhVZEtoV2lHZkRLYVUrMXhnOUNELzJnSWZzWVBzM1RUcTFzcTdvQ3M1cUxkVUhhVkw1a2NSYUhLZG5UaTdjczVpOXh6czNUc1VuWGNySlB3eWRqcCthRWt5UmgwN29NcFhCRW9iR2lzZkYycDFNQTZwVlcyZ2pteXdmN0Q1aVlFRkVMUWhNN3BvcVBOMy9rZkJ2VTFuN0xmZ3E3b3htdi84TEZpNFpvcHI1bnlxc3oyNlhQdFV5MVdxVHpnem5BbVArbk4wb0JURVJGVmJYWGRSYTNrMnY0Y3hUTlBuL0FnTUJBQUV3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUpZeFJPV1NPWmJPelh6YWZkR2pRS3NNZ045NDhHL2hId1Z1Wm5leUFjVm9MTUZUczFXZXlhOVorc25NcDF1MEFkREdtUVRTOXpHbkQ3c3lEWUdPbWdpZ09MY012TE1vV2Y1dENRQmJFdWtXOE83RFBqUlIwWHlwQ2hHU3NIc3FMR08wQjBIYVRlbDBIZFA5U2k4MjdPQ2tjOVErV2JzRkcvOC80VG9HV0wrdWxhMVd1TGF3b3pvajh1bVBpOUQ4aVhDb1czNXkyU1RVK1dGUUc3VytLZmR1KzJDWXovMHRHZHdWcU5HNFdzZmF3V2NoclMwMHZHRktqbS9mSmM4N3UybmphVWRnZjA2N3l3UTc1b2FMU1MyTkltbXo1YW9zM3Z1V21PWGhJTGQ3aVRVK0JEOFV2NnZXYkk3STFNPTwvZHM6WDUwOUNlcnRpZmljYXRlPjwvZHM6WDUwOURhdGE+PC9kczpLZXlJbmZvPjwvZHM6U2lnbmF0dXJlPjxzYW1scDpOYW1lSURQb2xpY3kgRm9ybWF0PXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnRyYW5zaWVudCBBbGxvd0NyZWF0ZT10cnVlLz48L3NhbWxwOkF1dGhuUmVxdWVzdD4=",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967238Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			true,
		},
		{
			"post signed request wrong signatureValue",
			args{
				request:    "PHNhbWxwOkF1dGhuUmVxdWVzdCB4bWxuczpzYW1sPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24geG1sbnM6c2FtbHA9dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIElEPWlkLWI4MTMxNDdlMjIzNjI1NzVkOGE2YWY4NzU2ZTNkZjVjMTM0MWVhMDAgVmVyc2lvbj0yLjAgSXNzdWVJbnN0YW50PTIwMjItMDQtMjBUMDk6MDM6NTcuNDk1WiBEZXN0aW5hdGlvbj1odHRwOi8vbG9jYWxob3N0OjUwMDAyL3NhbWwvU1NPIEFzc2VydGlvbkNvbnN1bWVyU2VydmljZVVSTD1odHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9hY3MgUHJvdG9jb2xCaW5kaW5nPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpiaW5kaW5nczpIVFRQLVBPU1Q+PHNhbWw6SXNzdWVyIEZvcm1hdD11cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHk+aHR0cDovL2xvY2FsaG9zdDo4MDAwL3NhbWwvbWV0YWRhdGFcPC9zYW1sOklzc3Vlclw+XDxkczpTaWduYXR1cmUgeG1sbnM6ZHM9aHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIz48ZHM6U2lnbmVkSW5mbz48ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09aHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEvPjxkczpSZWZlcmVuY2UgVVJJPSNpZC1iODEzMTQ3ZTIyMzYyNTc1ZDhhNmFmODc1NmUzZGY1YzEzNDFlYTAwPjxkczpUcmFuc2Zvcm1zPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPWh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMS8+PGRzOkRpZ2VzdFZhbHVlPnY4anF2OWdSekF3cmFjazNQSEhpeGRIT0s1az08L2RzOkRpZ2VzdFZhbHVlPjwvZHM6UmVmZXJlbmNlPjwvZHM6U2lnbmVkSW5mbz48ZHM6U2lnbmF0dXJlVmFsdWU+Y0h6VnpjR1MvOEhFSXZValJSRm9jNXp4eVVQMDkyanMwYWtucU5mekFURTBGY3JsK0xYb0RmNTllSHFCdUs3bTRFaWcxMEJIV2ZXa1BTK3dpczVseDZxc2dYcFhoY21VSUlwd2hNbkZveFBIWSs2Z2VDbGlycE02SUluOVd6M1ZGQ0E0by9sRTNqRG1NV1dHYXdTY3gyWHBXaEVFZmVvWnZHWjJ4U1JvL25zM3NTQkYvMXZHQ09KMzZJYzdNbXJyczZLOFZIQ0EvRUdOc0xyODVqMmxQelFqQzYwOTJ1TW9qaVErMDFQUFhqeUJUMkNkZWFvMXhYRU1YSWhvcVFNdmRzZExtcSs2ZGU4c2k0a0ZPVnpiS1Y4QTQ0WldSSEh4eTA1T2xWY1FXWnFoVEZOMUs4eTduRWYxYnp4QlE9PTwvZHM6U2lnbmF0dXJlVmFsdWU+PGRzOktleUluZm8+PGRzOlg1MDlEYXRhPjxkczpYNTA5Q2VydGlmaWNhdGU+TUlJQ3ZEQ0NBYVFDQ1FENkU4WkdzUTJ1c2pBTkJna3Foa2lHOXcwQkFRc0ZBREFnTVI0d0hBWURWUVFEREJWdGVYTmxjblpwWTJVdVpYaGhiWEJzWlM1amIyMHdIaGNOTWpJd01qRTNNVFF3TmpNNVdoY05Nak13TWpFM01UUXdOak01V2pBZ01SNHdIQVlEVlFRRERCVnRlWE5sY25acFkyVXVaWGhoYlhCc1pTNWpiMjB3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQzdYS2RDUnhVWlhqZHFWcXd3d09KcWMxQ2gwbk9TbWsrVWVya1VxbHZpV0hkZUxSK0ZvbEhLanFMekNCbG9BejR4VmMwREZmUjc2Z1djV0FISmxvcVo3R0JTN05wRGh6VjhHK2NYUStiVFUwTHUyZTczekNRYjMwWFVkS2hXaUdmREthVSsxeGc5Q0QvMmdJZnNZUHMzVFRxMXNxN29DczVxTGRVSGFWTDVrY1JhSEtkblRpN2NzNWk5eHpzM1RzVW5YY3JKUHd5ZGpwK2FFa3lSaDA3b01wWEJFb2JHaXNmRjJwMU1BNnBWVzJnam15d2Y3RDVpWUVGRUxRaE03cG9xUE4zL2tmQnZVMW43TGZncTdveG12LzhMRmk0Wm9wcjVueXFzejI2WFB0VXkxV3FUemd6bkFtUCtuTjBvQlRFUkZWYlhYZFJhM2sydjRjeFROUG4vQWdNQkFBRXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSll4Uk9XU09aYk96WHphZmRHalFLc01nTjk0OEcvaEh3VnVabmV5QWNWb0xNRlRzMVdleWE5Witzbk1wMXUwQWRER21RVFM5ekduRDdzeURZR09tZ2lnT0xjTXZMTW9XZjV0Q1FCYkV1a1c4TzdEUGpSUjBYeXBDaEdTc0hzcUxHTzBCMEhhVGVsMEhkUDlTaTgyN09Da2M5UStXYnNGRy84LzRUb0dXTCt1bGExV3VMYXdvem9qOHVtUGk5RDhpWENvVzM1eTJTVFUrV0ZRRzdXK0tmZHUrMkNZei8wdEdkd1ZxTkc0V3NmYXdXY2hyUzAwdkdGS2ptL2ZKYzg3NmdBZnhpTUgxSTlmWnZZU0F4QVozc1ZJLy9NbDJzVWRnZjA2N3l3UTc1b2FMU1MyTkltbXo1YW9zM3Z1V21PWGhJTGQ3aVRVK0JEOFV2NnZXYkk3STFNPTwvZHM6WDUwOUNlcnRpZmljYXRlPjwvZHM6WDUwOURhdGE+PC9kczpLZXlJbmZvPjwvZHM6U2lnbmF0dXJlPjxzYW1scDpOYW1lSURQb2xpY3kgRm9ybWF0PXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnRyYW5zaWVudCBBbGxvd0NyZWF0ZT10cnVlLz48L3NhbWxwOkF1dGhuUmVxdWVzdD4=",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967238Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			true,
		},
		{
			"post signed request wrong digestValue",
			args{
				request:    "PHNhbWxwOkF1dGhuUmVxdWVzdCB4bWxuczpzYW1sPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24geG1sbnM6c2FtbHA9dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIElEPWlkLWI4MTMxNDdlMjIzNjI1NzVkOGE2YWY4NzU2ZTNkZjVjMTM0MWVhMDAgVmVyc2lvbj0yLjAgSXNzdWVJbnN0YW50PTIwMjItMDQtMjBUMDk6MDM6NTcuNDk1WiBEZXN0aW5hdGlvbj1odHRwOi8vbG9jYWxob3N0OjUwMDAyL3NhbWwvU1NPIEFzc2VydGlvbkNvbnN1bWVyU2VydmljZVVSTD1odHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9hY3MgUHJvdG9jb2xCaW5kaW5nPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpiaW5kaW5nczpIVFRQLVBPU1Q+PHNhbWw6SXNzdWVyIEZvcm1hdD11cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHk+aHR0cDovL2xvY2FsaG9zdDo4MDAwL3NhbWwvbWV0YWRhdGFcPC9zYW1sOklzc3Vlclw+XDxkczpTaWduYXR1cmUgeG1sbnM6ZHM9aHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIz48ZHM6U2lnbmVkSW5mbz48ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09aHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEvPjxkczpSZWZlcmVuY2UgVVJJPSNpZC1iODEzMTQ3ZTIyMzYyNTc1ZDhhNmFmODc1NmUzZGY1YzEzNDFlYTAwPjxkczpUcmFuc2Zvcm1zPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPWh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMS8+PGRzOkRpZ2VzdFZhbHVlPnY4anF2OWdSemFtMnJhY2szUEhIaXhkSE9LNWs9PC9kczpEaWdlc3RWYWx1ZT48L2RzOlJlZmVyZW5jZT48L2RzOlNpZ25lZEluZm8+PGRzOlNpZ25hdHVyZVZhbHVlPmNIelZ6Y0dTLzhIRUl2VWpSUkZvYzV6eHlVUDB5VzFzekQvNnpHWWRibU0yaHZwMTdGNnZYTjlGanQwSm5xTmZ6QVRFMEZjcmwrTFhvRGY1OWVIcUJ1SzdtNEVpZzEwQkhXZldrUFMrd2lzNWx4NnFzZ1hwWGhjbVVJSXB3aE1uRm94UEhZKzZnZUNsaXJwTTZJSW45V3ozVkZDQTRvL2xFM2pEbU1XV0dhd1NjeDJYcFdoRUVmZW9adkdaMnhTUm8vbnMzc1NCRi8xdkdDT0ozNkljN01tcnJzNks4VkhDQS9FR05zTHI4NWoybFB6UWpDNjA5MnVNb2ppUSswMVBQWGp5QlQyQ2RlYW8xeFhFTVhJaG9xUU12ZHNkTG1xKzZkZThzaTRrRk9WemJLVjhBNDRaV1JISHh5MDVPbFZjUVdacWhURk4xSzh5N25FZjFienhCUT09PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlDdkRDQ0FhUUNDUUQ2RThaR3NRMnVzakFOQmdrcWhraUc5dzBCQVFzRkFEQWdNUjR3SEFZRFZRUUREQlZ0ZVhObGNuWnBZMlV1WlhoaGJYQnNaUzVqYjIwd0hoY05Nakl3TWpFM01UUXdOak01V2hjTk1qTXdNakUzTVRRd05qTTVXakFnTVI0d0hBWURWUVFEREJWdGVYTmxjblpwWTJVdVpYaGhiWEJzWlM1amIyMHdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDN1hLZENSeFVaWGpkcVZxd3d3T0pxYzFDaDBuT1NtaytVZXJrVXFsdmlXSGRlTFIrRm9sSEtqcUx6Q0Jsb0F6NHhWYzBERmZSNzZnV2NXQUhKbG9xWjdHQlM3TnBEaHpWOEcrY1hRK2JUVTBMdTJlNzN6Q1FiMzBYVWRLaFdpR2ZES2FVKzF4ZzlDRC8yZ0lmc1lQczNUVHExc3E3b0NzNXFMZFVIYVZMNWtjUmFIS2RuVGk3Y3M1aTl4enMzVHNVblhjckpQd3lkanArYUVreVJoMDdvTXBYQkVvYkdpc2ZGMnAxTUE2cFZXMmdqbXl3ZjdENWlZRUZFTFFoTTdwb3FQTjMva2ZCdlUxbjdMZmdxN294bXYvOExGaTRab3ByNW55cXN6MjZYUHRVeTFXcVR6Z3puQW1QK25OMG9CVEVSRlZiWFhkUmEzazJ2NGN4VE5Qbi9BZ01CQUFFd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFKWXhST1dTT1piT3pYemFmZEdqUUtzTWdOOTQ4Ry9oSHdWdVpuZXlBY1ZvTE1GVHMxV2V5YTlaK3NuTXAxdTBBZERHbVFUUzl6R25EN3N5RFlHT21naWdPTGNNdkxNb1dmNXRDUUJiRXVrVzhPN0RQalJSMFh5cENoR1NzSHNxTEdPMEIwSGFUZWwwSGRQOVNpODI3T0NrYzlRK1dic0ZHLzgvNFRvR1dMK3VsYTFXdUxhd296b2o4dW1QaTlEOGlYQ29XMzV5MlNUVStXRlFHN1crS2ZkdSsyQ1l6LzB0R2R3VnFORzRXc2Zhd1djaHJTMDB2R0ZLam0vZkpjODc2Z0FmeGlNSDFJOWZadllTQXhBWjNzVkkvL01sMnNVZGdmMDY3eXdRNzVvYUxTUzJOSW1tejVhb3MzdnVXbU9YaElMZDdpVFUrQkQ4VXY2dldiSTdJMU09PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWxwOk5hbWVJRFBvbGljeSBGb3JtYXQ9dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6dHJhbnNpZW50IEFsbG93Q3JlYXRlPXRydWUvPjwvc2FtbHA6QXV0aG5SZXF1ZXN0Pg==",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967238Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			true,
		},

		{
			"post signed request changed request",
			args{
				request:    "PHNhbWxwOkF1dGhuUmVxdWVzdCB4bWxuczpzYW1sPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24geG1sbnM6c2FtbHA9dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIElEPWlkLWI4MTMxNDdlMjIzNjI1NzVkOGE2YWY4NzU2ZTNkZjVjMTM0MWVhMDAgVmVyc2lvbj0yLjAgSXNzdWVJbnN0YW50PTIwMjItMDQtMjBUMDk6MDM6NTcuNDk1WiBEZXN0aW5hdGlvbj1odHRwOi8vbG9jYWxob3N0OjUwMDAyL3NhbWwvU1NPIEFzc2VydGlvbkNvbnN1bWVyU2VydmljZVVSTD1odHRwOi8vbG9jYWxob3N0OjgwMDAvc2FtbC9hY3MgUHJvdG9jb2xCaW5kaW5nPXVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpiaW5kaW5nczpIVFRQLVBPU1Q+PHNhbWw6SXNzdWVyIEZvcm1hdD11cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHk+aHR0cDovL2xvY2FsaG9zdDo4MDAwL3NhbWwvbWV0YWRhdGFcPC9zYW1sOklzc3Vlclw+XDxkczpTaWduYXR1cmUgeG1sbnM6ZHM9aHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIz48ZHM6U2lnbmVkSW5mbz48ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09aHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEvPjxkczpSZWZlcmVuY2UgVVJJPSNpZC1iODEzMTQ3ZTIyMzYyNTc1ZDhhNmFmODc1NmUzZGY1YzEzNDFlYTAwPjxkczpUcmFuc2Zvcm1zPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPWh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT1odHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMS8+PGRzOkRpZ2VzdFZhbHVlPnY4anF2OWdSekF3cmFjazNQSEhpeGRIT0s1az08L2RzOkRpZ2VzdFZhbHVlPjwvZHM6UmVmZXJlbmNlPjwvZHM6U2lnbmVkSW5mbz48ZHM6U2lnbmF0dXJlVmFsdWU+Y0h6VnpjR1MvOEhFSXZValJSRm9jNXp4eVVQMHlXMXN6RC82ekdZZGJtTTJodnAxN0Y2dlhOOUZqdDBKbnFOZnpBVEUwRmNybCtMWG9EZjU5ZUhxQnVLN200RWlnMTBCSFdmV2tQUyt3aXM1bHg2cXNnWHBYaGNtVUlJcHdoTW5Gb3hQSFkrNmdlQ2xpcnBNNklJbjlXejNWRkNBNG8vbEUzakRtTVdXR2F3U2N4MlhwV2hFRWZlb1p2R1oyeFNSby9uczNzU0JGLzF2R0NPSjM2SWM3TW1ycnM2SzhWSENBL0VHTnNMcjg1ajJsUHpRakM2MDkydU1vamlRKzAxUFBYanlCVDJDZGVhbzF4WEVNWElob3FRTXZkc2RMbXErNmRlOHNpNGtGT1Z6YktWOEE0NFpXUkhIeHkwNU9sVmNRV1pxaFRGTjFLOHk3bkVmMWJ6eEJRPT08L2RzOlNpZ25hdHVyZVZhbHVlPjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSUN2RENDQWFRQ0NRRDZFOFpHc1EydXNqQU5CZ2txaGtpRzl3MEJBUXNGQURBZ01SNHdIQVlEVlFRRERCVnRlWE5sY25acFkyVXVaWGhoYlhCc1pTNWpiMjB3SGhjTk1qSXdNakUzTVRRd05qTTVXaGNOTWpNd01qRTNNVFF3TmpNNVdqQWdNUjR3SEFZRFZRUUREQlZ0ZVhObGNuWnBZMlV1WlhoaGJYQnNaUzVqYjIwd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUM3WEtkQ1J4VVpYamRxVnF3d3dPSnFjMUNoMG5PU21rK1VlcmtVcWx2aVdIZGVMUitGb2xIS2pxTHpDQmxvQXo0eFZjMERGZlI3NmdXY1dBSEpsb3FaN0dCUzdOcERoelY4RytjWFErYlRVMEx1MmU3M3pDUWIzMFhVZEtoV2lHZkRLYVUrMXhnOUNELzJnSWZzWVBzM1RUcTFzcTdvQ3M1cUxkVUhhVkw1a2NSYUhLZG5UaTdjczVpOXh6czNUc1VuWGNySlB3eWRqcCthRWt5UmgwN29NcFhCRW9iR2lzZkYycDFNQTZwVlcyZ2pteXdmN0Q1aVlFRkVMUWhNN3BvcVBOMy9rZkJ2VTFuN0xmZ3E3b3htdi84TEZpNFpvcHI1bnlxc3oyNlhQdFV5MVdxVHpnem5BbVArbk4wb0JURVJGVmJYWGRSYTNrMnY0Y3hUTlBuL0FnTUJBQUV3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUpZeFJPV1NPWmJPelh6YWZkR2pRS3NNZ045NDhHL2hId1Z1Wm5leUFjVm9MTUZUczFXZXlhOVorc25NcDF1MEFkREdtUVRTOXpHbkQ3c3lEWUdPbWdpZ09MY012TE1vV2Y1dENRQmJFdWtXOE83RFBqUlIwWHlwQ2hHU3NIc3FMR08wQjBIYVRlbDBIZFA5U2k4MjdPQ2tjOVErV2JzRkcvOC80VG9HV0wrdWxhMVd1TGF3b3pvajh1bVBpOUQ4aVhDb1czNXkyU1RVK1dGUUc3VytLZmR1KzJDWXovMHRHZHdWcU5HNFdzZmF3V2NoclMwMHZHRktqbS9mSmM4NzZnQWZ4aU1IMUk5Zlp2WVNBeEFaM3NWSS8vTWwyc1VkZ2YwNjd5d1E3NW9hTFNTMk5JbW16NWFvczN2dVdtT1hoSUxkN2lUVStCRDhVdjZ2V2JJN0kxTT08L2RzOlg1MDlDZXJ0aWZpY2F0ZT48L2RzOlg1MDlEYXRhPjwvZHM6S2V5SW5mbz48L2RzOlNpZ25hdHVyZT48c2FtbHA6TmFtZUlEUG9saWN5IEZvcm1hdD1jaGFuZ2VkIEFsbG93Q3JlYXRlPXRydWUvPjwvc2FtbHA6QXV0aG5SZXF1ZXN0Pg==",
				spMetadata: "<EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967Z\" entityID=\"http://localhost:8000/saml/metadata\">\n  <SPSSODescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" validUntil=\"2022-04-10T13:51:05.967238Z\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\" AuthnRequestsSigned=\"true\" WantAssertionsSigned=\"true\">\n    <KeyDescriptor use=\"encryption\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes192-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"></EncryptionMethod>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\"></EncryptionMethod>\n    </KeyDescriptor>\n    <KeyDescriptor use=\"signing\">\n      <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n        <X509Data xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n          <X509Certificate xmlns=\"http://www.w3.org/2000/09/xmldsig#\">MIICvDCCAaQCCQD6E8ZGsQ2usjANBgkqhkiG9w0BAQsFADAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTQwNjM5WhcNMjMwMjE3MTQwNjM5WjAgMR4wHAYDVQQDDBVteXNlcnZpY2UuZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7XKdCRxUZXjdqVqwwwOJqc1Ch0nOSmk+UerkUqlviWHdeLR+FolHKjqLzCBloAz4xVc0DFfR76gWcWAHJloqZ7GBS7NpDhzV8G+cXQ+bTU0Lu2e73zCQb30XUdKhWiGfDKaU+1xg9CD/2gIfsYPs3TTq1sq7oCs5qLdUHaVL5kcRaHKdnTi7cs5i9xzs3TsUnXcrJPwydjp+aEkyRh07oMpXBEobGisfF2p1MA6pVW2gjmywf7D5iYEFELQhM7poqPN3/kfBvU1n7Lfgq7oxmv/8LFi4Zopr5nyqsz26XPtUy1WqTzgznAmP+nN0oBTERFVbXXdRa3k2v4cxTNPn/AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJYxROWSOZbOzXzafdGjQKsMgN948G/hHwVuZneyAcVoLMFTs1Weya9Z+snMp1u0AdDGmQTS9zGnD7syDYGOmgigOLcMvLMoWf5tCQBbEukW8O7DPjRR0XypChGSsHsqLGO0B0HaTel0HdP9Si827OCkc9Q+WbsFG/8/4ToGWL+ula1WuLawozoj8umPi9D8iXCoW35y2STU+WFQG7W+Kfdu+2CYz/0tGdwVqNG4WsfawWchrS00vGFKjm/fJc876gAfxiMH1I9fZvYSAxAZ3sVI//Ml2sUdgf067ywQ75oaLSS2NImmz5aos3vuWmOXhILd7iTU+BD8Uv6vWbI7I1M=</X509Certificate>\n        </X509Data>\n      </KeyInfo>\n    </KeyDescriptor>\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/slo\" ResponseLocation=\"http://localhost:8000/saml/slo\"></SingleLogoutService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"http://localhost:8000/saml/acs\" index=\"1\"></AssertionConsumerService>\n    <AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\" Location=\"http://localhost:8000/saml/acs\" index=\"2\"></AssertionConsumerService>\n  </SPSSODescriptor>\n</EntityDescriptor>",
			},
			true,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			spConfig := &serviceprovider.Config{Metadata: []byte(tt.args.spMetadata)}

			sp, err := serviceprovider.NewServiceProvider("test", spConfig, func(s string) string { return "" })
			if err != nil {
				t.Errorf("verifyPostSignature() got = %v, wanted to create service provider instance", err)
				return
			}

			requestF := func() string {
				return tt.args.request
			}
			spF := func() *serviceprovider.ServiceProvider {
				return sp
			}
			errF := func(err error) {
				if (err != nil) != tt.err {
					t.Errorf("verifyPostSignature() got = %v, want %v", err, tt.err)
				}
			}

			gotF := verifyPostSignature(requestF, spF, errF)
			got := gotF()
			if (got != nil) != tt.err {
				t.Errorf("verifyPostSignature() got = %v, want %v", got, tt.err)
				return
			}
		})
	}
}
